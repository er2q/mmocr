# Copyright (c) OpenMMLab. All rights reserved.
from mmocr.models.builder import CONVERTORS
from mmocr.utils import list_from_file

rctw = 'λⅱ栖沉攀疾棵以瞪排殿配井辣仔驰栢岩黄烹A肿泡憧猕工荡教４侦火拘坠缇劲种ΛO迪刨摔状蝎線員始冬臣叟别饺模守枪髓雲油漆午胃我魏析烽副貌滤戒芳屿硅茏娅杯该斜少馅爽琢吐娄界鳕膳塞籍酒更裳恰赚慧宠慈淀急爪蛇圜陂藕坞谜個瑪赋冯晕威削番馒访屑袖细茸煎翻你输川喻添×寧祝律彻渣竟廰昆驻揽葛绪敌奋含醇縤焙岳芥授接癌素嘲監咨俩牡蔓履D叫首择萌旭鱻留4延利妥e冠泼痿阱澜W軍房敏歸炮崩乒郴陶搅盲豹掠歧婺拟璨肠辐鲜團推“梭街改阜頂尝百刚话震銀鞘标酥盼恶喧五裹晓嘴藤蚁这徒叔晖涨東休煸许炎新片榔軒咬臀买芹莫叶溺流珞伍偏钛灯電墩果7募杨吃邱撑玲郭牌圈絮弄門藏逻蹄瘾远连圖烤悔赵龄化撕临茅粘摩姚佳暮沿幻腹久顶烟穷忽熊齊织腐琥己证揚旅池跟亿累销凹肆時碗汨婧净售有學沛烦规权疯脖糕鳞哥刘助馨悍灾伽艾甸谭墙萍撒双正砖喉狼卤筑痣畏他游烫雕破汪梧裕电味停汁估享踩樊咕恐崧塊沪檬草棋终室蕟积仕桐鱼硬类弹业足差峻柑辙高乐仲普摆爯匙衡沌么驼醋冻丑芬非算将参做粒諧嶺勋浇责邮瞬俞域宜扩娃倚灸寂跌6殷振馄需乎亩犇橄缸扒劵長壶/纬季钣歉善吴班纸浅嫌专唇害谈示仿册皮夢科津谢俄柳迁祈涓叹矽挚鹏问靓為缺聊已筝s事瘦米莒真蕲陷预虾泥柔眠蒙莉砺呗烨笋拎漂扇蜀镔浴服激哉寇租瑟胎烈比燥董鹿变刁吸℃骑掉红赃泵痹讲靠题恤偉颂咔指交+岭校闯卵莊哭拐编麗让卿八贺嵌肪英間宴行籽弥优鼻伪鸽般瀚取扬鳄梁够襄史厦创兔匡蓬雅骨斗噁罚慶佃直坤谱鸡。持佐杰彤朝补逅拌传沸踞络第娠和楂疮厅镜最恬槗幕难宏賜得鸭闭虐四歪九协几尊飛顺革气燕调邦窝骥猴订氟赣请邰要慌卜堵|阔晦展陵辞递诺瞳成茗猎满厂奖菀星嫒疼命濡秋务厕踊毅姬%沁怎偷泾齐》浠匀选軌担瑜哩金逗年杆苛抑遗哦链晨園喀固栗丛象局拿描町弓見瞩顽魂巢异捞绑，扔端雀铝韩兑录付策压莎馍谨黎沱俭桦中>渍走婆耗袋風膀話慢痔门赌冕居洗菜波彰酵儿些槟捐小扶愿鞋察户蹭歌秦略瑚愁苞鮮伞单决遵叠耽缓棠崴又秸虚云迎旺〇陆告呼歲祥只稠侣验邀色反纺虏賀紫樟犸矮犀暂腩旬陽意坂球丘尸咋妙起烁塘蓄结多借糍橘涛稻委桃無尹妹卓印警倒香促報缈叮瓶惬潘p蓝宣贫蔻存來顿联槐糟袜濛荣窥哄打棚磨护闻哟帮坐员败侧陀早漳近岱语痛丝仓悠埠北晃璞桂闹洱衫购務缴们糖理踏然術笔栽蒋渝钓蕾看彌帕夹忠缩田孙焦读雷揭淑鹭桥浏快睦劉拒槽彬株贞彪筛艰喂磅哎飞胞馬货罐邸巴B诵各典症倩允众鳯止婉丢泊挠动逛卫曼点镌逾謝粮脊泷妈葫赞粱约L牧禅E熬合浣辖毕默黛厍鴨馔情禁楊氨榄此祛挡诊蜥蜘个绵禽您弦稍罩摊喽㎡岛嘉粉篓乔材劳原貝月倍每用@莴频永蕃骤佟漏k萝海顷梯澳件体会聪肘峨若巅簧应巡名®柜融書耶椎荆菲辩抄度～逑膏债￥瓦闪刷诱兹妞篆興宁玉杀纠關褐鸦研障=營均钟卧”私侈阻钞禧妨柄毒翰扰签骗卢镇稀族奥汇敢窖姑视黔T拖饲克忧鸟的逸犊濤２甘掘古扫５援l滕页搬餘屋挑施磐壹从訪乍、河储湘背信蟹宸驱豆　鱿讨蜴爵渡廣热步搁呜锁说浆娥F主郑静鲫后两设拓切框粗啊尽陌霞√呀车爱堤宗尖某粥庞赢糯聂愧勤玫轭囤【奕宫摧惟玖刊世迈饰势镭拍肯浑腻撞莺举经仞肖孫皱Y溇喝程审吞去目柠稚源啦寿右深茉肴拉拢缤滁榜熄姆究场农汾飾附君鲨贱纵斓弗棕幸困很况唆廠懒厉搜岗撸斑召璃继凌碑益扦作奔颖黑聘西姿纷墅病杜淘r修忘眞架穴载膜缘横战藍抬幼酱版污尚雾铮队叁郢苗哈氮琯曲塬岁°诸尾据苦痢嗯痰旱榨3构食b花相吼丹逹唐囊御劝删养仁凤宋渔束屌骏娇坡晚崽但仅资措网恒拇筐胆愚仗托福阆半６７痪艷義泪归睿纪杭斤离武涎碴婦涂日本犬汀装匠籁車涵铂瞅侬放挨沃欧钾貼跑翔仙断寞脆凸亥幢辰轮绸蝇孚落庙妃捧[硒晴自符触缆賢賣冲鸣乌椒平坪纳？十醍档a是维挣喔琪Ⅱ千友庶股押徽玮秧陕兆昊戳税逊曹矿混垃占圾羽达盛济加梨盔朱烩亲碎肢健睛滋驴绳娟对苹征睡寻增裸擎蔡绮狭沫瀛找轨蔑橱撰鬼湾旗萬把祸易营布抵裤兵互母聚…菠槿吆长测层觅裙沐违启崋俘仟饨迭者毛干揉缔吊龟峩彦透二萄滨之芒核由课怦她范冶栏华雪阿碳须厌薡亚莓敦兽可勾具弘巷惠帛洛低赴突蝶乙矩避抱写伤疫旋漾水靴父篷学)器屯抚呦捂坏咖慰沥於浦斋赶寓廿酮#义颠肩洲龍惹鹰却部X拼奶裴液貴纽g哮缰窄娶显妮贩翳圭运随报燃在雉紅鴻掐肾腾勉枚库盘餐柒戈罪奉查牢進燒寄贰赁桩谐煤越衍捍蛭芝痴趣嫂咏厢涉章针柴晒制衬沙它琬次弱埃款郸考蛋彼穿佑珂管手捶址炝戚擀猪淤踪芦独1特翠践樱身嬉鹦脯兮兜术伟芙绍言元芽绣雨子娱监臺奈搞發菌扁完尼爷洒積鉴贝靶梵亭道瞰剩翘释鸿葆舌候忌俐坊亏虽依肚＋菊良俏跃乡江颗窗業療献致澡节冒痒帘總遛光渗迹饭涌狸-没逝定暑·壮輝阀焊贪砸号峦造椅骠牵蜡胡菱翼馆祯贵驿否熔蜓过萱扎炉怡亮珊续著途潭忍吾酿K影伦抛煞府）皇虎歇额景Q漫磁y吓窜息堰阵发冰康地境口鳝嗨祖垦敬勘裝外飘莞宇３煌讯礡挤闷秒碧—板晶佗泌渴媒薏议蜻赈煮契披社碍晋坛遍湿豉畔筒饿h铃衔还壇蓮分盒邻进蕴咚夙俺;企爹畜届焰遂刹捕佬铠荷惨散吹舒砍钳寨列贴按绎≤巍哒循甚欣稳藥执n闽欢产姜嘞糊费返庆】吕猛殖纲陳炒扮博榕x丈颁甫號祠\'钢广办昌脸坨胶屁抗催郁胖挪投蒜奴丰媚关都鲁脑师绩凡浮处９瑷三瑰降瞧缝来职鼎腕软檀磷面哇鲍寝崇P蕉鹉桑确评抓哲I薇樸士圣俪帅操杏钻欺焖声叭痘狐暨≠岐琳暴听轻损溪孜眙陪貂尧牙迅统’军噜喱坦壬家勇钮墨簡麟惊碟综毫弯荤浥惑省残莲瓷句墓纱犹現忆再隧被莱呵林获识麻阡淵C粽創孕帽抽烘纹啤泉丁聞求耒腔南逐习烙老喜辽乃珩携播翅泳場诚辅龙攝妊柏沂顾韻邪蘇同拙疲银负尔剃皖炼砂峯暖清辜稅箫掏S遭藝保露咱遠宪筹伏俱喵鹅堆短請锡盟菘笛薈廖帼飮禪勒耕望統齿艳萧泽向淮嘀雄洞叉诉釜漁于_县荐美毋引達機珠伸锲万氧茶肃绕麓六葉邑吨華Z移啡率遥导巩批图窈圳贬鹤春笑团谕好衰啄汗獴氛郎媳裂缕呈丫刀则鸳较蔬扳未纤才折弟秭蛙疝翡夺妍填韵辈淇而画并與妻颜消故纰检沔想培酬钜青艇着书菩立危容恨即航搏思恪闵就出韬戟淡箱趴馋照●國级館疑咸质夏環朋壁盈竭卷炭婴槛眼值闲寰節鶴洋控蔷宿瓜辊似噢藓希瞎卡資欠派韧嗒亨植爆映媛富袁盾蒲刻楹妖忙赖沈宝太染鲈上注见强今颐铜‘诞囍瀘儒坝淫蘭泛財5钱系重序赤臻血佛梓谛（玛区羊稞封减力给数醒旖G肥薹N等芡蔚辉駐嘘瓯脾宙荔形眉邓李丙吗准韭跪搭怠润捡榴愈换阖王拽恢悄醜庐温钥蒸脏霸饯型氰胜格啪盆绘边屹芊篇喇筋乓酉假雁蓉央怀梅位羯谊简贸屈淋驶玻亦罗硫?芋包组凉咀篮错锻镀V救逍卸踢泰啥朕承糙懂剑炜洪楚耀盐赏像!渠串１骂漠何孝]拜芯礼皓樂敛乳券领射德了炫摘瘫微陡械登鄂努魚會待旧除招演c励慕民厚蛛玩侨婵女稗寅索逢骋袭苏疗刺R；全活甩驾悉空偕粤堡樽閣乱锣硕雜一鶏\鲸遇澈先邗免镶洁如繁式煨法乾患饮览白曦蕙内瑅仑础飲蚕憶丽摇与丸勺垂妾朗摒崔薯嫁任茜伯阳逃枸桔順乖茵畸畅国扑枢店尤甲諾音歡送臧划屏蕊大妇抹塑令石瑙¥锐捷寺探郡苕讽插阴帖朔无齋防闺韦蒂谅通击唤埔拨鸠呐掌谎野段亡豌介葡矫烂座設恩绅闸卑马粹&旦肝荞烧猜虫札郊窕耳紧谣那侯钉榭魅蚝毁昭邯宅帰怪滴伶代纯艺匹采復帝必巨０伊苓芭腊碱棉天豪潜觉治覆冷秩阑箭公隔荟诗朽钙夜拾恋<u为M寒炖熟距唧運浓茂余戴淳拥 整供呆氓置票佩萃菁凯计巾惕挖處鎖悲氣秉帆氯霖兼育功垩羅饼生.崛奢脚巧人账解澤衣耿另州肺认森基晰遮绚擦佣昔周鼓台哪J痕隆速山贷谷缠婚赠爬环誓盖孟螺驪薪廳㷛涯o霍因渺婿d宽誉便枉案記七汽咪带茄魔弃婷溃底"京肛喘裱嘿焱妄铺岔绝嘶璧連镍零脱胸宾$甜：旁开聋瑄钰z浩梳柯响嚒酷雎跳竺佰2陈剪惜回怕铸哆蜂埋答劈珍峡斐麒娘俊倦诈孩傲记汉阶辛复财轧鞍趟凭政醫唯滚悟舰旨腰撤龚湛倪楼邹琉适壽使凰谋汤痍争逼呕谁炸揍里愛咯城赔寶偿不旷述限牟朵失练潮枕浪项共论(物支割备竹替骚酪飯充样t挞狮犯耐灶傳愉滑脂孵汕夫怖安碁药客尘挥码心虹焗壳陣呢潢垒询朦舍奠昵邂葚路神廊蝴麦剧傻文畴骆趋贤孔軎卉性應夯躬瑞幽粼鸯珑嫩跆木险蚊柚块~奇末词栓維舟严铭及床隙密薰往鞭鲢能琼珀试姨聯吉憩赛钧《或颊量項^≥抢泸剐莅角精阁敲肤提張表彭悬黃饱騰绿檔吻机念称拆砌诠伙葱贡夕H现j锋！函摸入知姐廉笼鋪赐鲤臂退其彩娜追攻禾呷霾握荒左卖柱枯拯际坚兴浙宵楽跨港霜醉焕栈•桌键侍贯超杞庄瞄时肉钿載刮酚樓条桶轴遣哗汰鼠狂疤兰苯总谓志惩鍋卦橋庭秀价璀盱*套司舶經实帐舱菇砰峰锈孤拳绽痧馈疏感斯酯升贼童堂陋督态榈熙村噗寳曙苑风碰也鷺皂漢技滩倾m疆刪唑倡i岚棺沟悦冈到斌线脉官掩初腿松羲w锦證葵凳吧挂枫张什嘻灼期冤收勿栋刑棒椰唱戏品惯阅v狗厨灭硚医市转耍蹈谌睫例受塔唉席所灰男緹剂圆隐涝琴屎头训辋緻迷灣申土乘枝仰岸详灵猫枣尨賦泓喷爸铁皆:院荧0寸玥q杂羞傅茨點恭吵建開9凝奏幂垫概舞姓死集篝站湖尺實灌仪绒僵蜜船厘區養间徐擅橙当粑俯观涮嘟住园废薄澄²撼禮既摄聖弧颈商U窃牛党辆珈轩臨暗豫動曾围煲明梦秘8肌氢勃妆翁叼拔下琦f憬方鑫历萨东根予极箔臭尿溶币智甄群径属朴兄酸氏份扣泄料常字溢锅盗树前缭扯效铅慎毯伴至矛逆竞'

@CONVERTORS.register_module()
class BaseConvertor:
    """Convert between text, index and tensor for text recognize pipeline.

    Args:
        dict_type (str): Type of dict, options are 'DICT36', 'DICT37', 'DICT90'
            and 'DICT91'.
        dict_file (None|str): Character dict file path. If not none,
            the dict_file is of higher priority than dict_type.
        dict_list (None|list[str]): Character list. If not none, the list
            is of higher priority than dict_type, but lower than dict_file.
    """
    start_idx = end_idx = padding_idx = 0
    unknown_idx = None
    lower = False

    dicts = dict(
        DICT36=tuple('0123456789abcdefghijklmnopqrstuvwxyz'),
        DICT90=tuple('0123456789abcdefghijklmnopqrstuvwxyz'
                     'ABCDEFGHIJKLMNOPQRSTUVWXYZ!"#$%&\'()'
                     '*+,-./:;<=>?@[\\]_`~'),
        # With space character
        DICT37=tuple('0123456789abcdefghijklmnopqrstuvwxyz '),
        DICT91=tuple('0123456789abcdefghijklmnopqrstuvwxyz'
                     'ABCDEFGHIJKLMNOPQRSTUVWXYZ!"#$%&\'()'
                     '*+,-./:;<=>?@[\\]_`~ '),
        DICT92=tuple('0123456789abcdefghijklmnopqrstuvwxyz'
                     'ABCDEFGHIJKLMNOPQRSTUVWXYZ!"#$%&\'()'
                     '*+,-./:;<=>?@[\\]_`~ |{}^’•'),

        RCTW=tuple(rctw))

    def __init__(self, dict_type='DICT90', dict_file=None, dict_list=None):
        assert dict_file is None or isinstance(dict_file, str)
        assert dict_list is None or isinstance(dict_list, list)
        self.idx2char = []
        if dict_file is not None:
            for line_num, line in enumerate(list_from_file(dict_file)):
                line = line.strip('\r\n')
                if len(line) > 1:
                    raise ValueError('Expect each line has 0 or 1 character, '
                                     f'got {len(line)} characters '
                                     f'at line {line_num + 1}')
                if line != '':
                    self.idx2char.append(line)
        elif dict_list is not None:
            self.idx2char = list(dict_list)
        else:
            if dict_type in self.dicts:
                self.idx2char = list(self.dicts[dict_type])
            else:
                raise NotImplementedError(f'Dict type {dict_type} is not '
                                          'supported')

        assert len(set(self.idx2char)) == len(self.idx2char), \
            'Invalid dictionary: Has duplicated characters.'

        self.char2idx = {char: idx for idx, char in enumerate(self.idx2char)}

    def num_classes(self):
        """Number of output classes."""
        return len(self.idx2char)

    def str2idx(self, strings):
        """Convert strings to indexes.

        Args:
            strings (list[str]): ['hello', 'world'].
        Returns:
            indexes (list[list[int]]): [[1,2,3,3,4], [5,4,6,3,7]].
        """
        assert isinstance(strings, list)

        indexes = []
        for string in strings:
            if self.lower:
                string = string.lower()
            index = []
            for char in string:
                char_idx = self.char2idx.get(char, self.unknown_idx)
                if char_idx is None:
                    raise Exception(f'Chararcter: {char} not in dict,'
                                    f' please check gt_label and use'
                                    f' custom dict file,'
                                    f' or set "with_unknown=True"')
                index.append(char_idx)
            indexes.append(index)

        return indexes

    def str2tensor(self, strings):
        """Convert text-string to input tensor.

        Args:
            strings (list[str]): ['hello', 'world'].
        Returns:
            tensors (list[torch.Tensor]): [torch.Tensor([1,2,3,3,4]),
                torch.Tensor([5,4,6,3,7])].
        """
        raise NotImplementedError

    def idx2str(self, indexes):
        """Convert indexes to text strings.

        Args:
            indexes (list[list[int]]): [[1,2,3,3,4], [5,4,6,3,7]].
        Returns:
            strings (list[str]): ['hello', 'world'].
        """
        assert isinstance(indexes, list)

        strings = []
        for index in indexes:
            string = [self.idx2char[i] for i in index]
            strings.append(''.join(string))

        return strings

    def tensor2idx(self, output):
        """Convert model output tensor to character indexes and scores.
        Args:
            output (tensor): The model outputs with size: N * T * C
        Returns:
            indexes (list[list[int]]): [[1,2,3,3,4], [5,4,6,3,7]].
            scores (list[list[float]]): [[0.9,0.8,0.95,0.97,0.94],
                [0.9,0.9,0.98,0.97,0.96]].
        """
        raise NotImplementedError
